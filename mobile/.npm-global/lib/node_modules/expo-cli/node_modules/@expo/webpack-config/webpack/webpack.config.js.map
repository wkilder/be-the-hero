{"version":3,"file":"webpack.config.js","sourceRoot":"","sources":["../src/webpack.config.ts"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA,gBAAgB,CAAC,MAAM;AACvB,qBAAqB;AACrB,4EAAkD;AAClD,gGAAwE;AACxE,kHAA0F;AAC1F,qCAA8F;AAC9F,0FAAuE;AACvE,sFAAqD;AACrD,yCAAgD;AAChD,kDAA0B;AAC1B,+DAA0D;AAC1D,8EAAoD;AACpD,uCAMkB;AAClB,uCAAwC;AACxC,mCAAiC;AACjC,sFAA2D;AAC3D,uDAAyC;AACzC,gDAAwB;AAExB,qCAAsF;AACtF,+BAOe;AACf,uCAA6C;AAC7C,uCASmB;AAGnB,mCAAuD;AAEvD,2FAA2F;AAC3F,MAAM,kBAAkB,GAAG,gBAAO,CAAC,oBAAoB,EAAE,IAAI,CAAC,CAAC;AAE/D,SAAS,UAAU,CACjB,EAAE,UAAU,EAAE,WAAW,EAAiD,EAC1E,EAAE,OAAO,EAAiC;IAE1C,IAAI,UAAU,EAAE;QACd,kBAAkB;QAClB,IAAI,OAAO,KAAK,SAAS,EAAE;YACzB,8GAA8G;YAC9G,OAAO,OAAO,CAAC;SAChB;QACD,OAAO,kBAAkB,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,KAAK,CAAC;KAClD;IACD,IAAI,WAAW,EAAE;QACf,OAAO,yBAAyB,CAAC;KAClC;IACD,OAAO,KAAK,CAAC;AACf,CAAC;AAED,SAAS,SAAS,CAAC,SAAoB,EAAE,IAAU,EAAE,UAAkB;IACrE,MAAM,YAAY,GAAW;QAC3B,0EAA0E;QAC1E,6BAA6B;QAC7B,UAAU;QACV,qCAAqC;QACrC,IAAI,EAAE,SAAS,CAAC,UAAU,CAAC,MAAM;QACjC,8DAA8D;QAC9D,kEAAkE;QAClE,YAAY,EAAE,MAAM;KACrB,CAAC;IAEF,IAAI,IAAI,KAAK,YAAY,EAAE;QACzB,YAAY,CAAC,QAAQ,GAAG,qCAAqC,CAAC;QAC9D,sEAAsE;QACtE,YAAY,CAAC,aAAa,GAAG,2CAA2C,CAAC;QACzE,+EAA+E;QAC/E,YAAY,CAAC,6BAA6B,GAAG,CAC3C,IAA+C,EACvC,EAAE,CAAC,cAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,IAAI,EAAE,IAAI,CAAC,oBAAoB,CAAC,CAAC,OAAO,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC;KAC3F;SAAM;QACL,sDAAsD;QACtD,qCAAqC;QACrC,YAAY,CAAC,QAAQ,GAAG,IAAI,CAAC;QAC7B,6DAA6D;QAC7D,mDAAmD;QACnD,YAAY,CAAC,QAAQ,GAAG,qBAAqB,CAAC;QAC9C,sEAAsE;QACtE,YAAY,CAAC,aAAa,GAAG,2BAA2B,CAAC;QACzD,+EAA+E;QAC/E,YAAY,CAAC,6BAA6B,GAAG,CAC3C,IAA+C,EACvC,EAAE,CAAC,cAAI,CAAC,OAAO,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC,OAAO,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC;KAC1E;IAED,OAAO,YAAY,CAAC;AACtB,CAAC;AAED,mBACE,GAAgB,EAChB,OAAkB,EAAE;;QAEpB,IAAI,QAAQ,IAAI,GAAG,EAAE;YACnB,OAAO,CAAC,IAAI,CACV,eAAK,CAAC,KAAK,CAAC,KAAK,CACf,gIAAgI,CACjI,CACF,CAAC;SACH;QACD,MAAM,MAAM,GAAG,eAAS,CAAC,GAAG,CAAC,CAAC;QAC9B,MAAM,IAAI,GAAG,aAAO,CAAC,GAAG,CAAC,CAAC;QAC1B,MAAM,KAAK,GAAG,IAAI,KAAK,aAAa,CAAC;QACrC,MAAM,MAAM,GAAG,IAAI,KAAK,YAAY,CAAC;QAErC,kDAAkD;QAClD,+BAA+B;QAC/B,4CAA4C;QAC5C,MAAM,wBAAwB,GAAG,oCAA4B,CAC3D,GAAG,CAAC,yBAAyB,EAC7B,KAAK;QACL,SAAS;SACV,CAAC;QAEF,MAAM,SAAS,GAAG,GAAG,CAAC,SAAS,IAAI,CAAC,MAAM,mBAAa,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC,CAAC;QAE1E,MAAM,EAAE,UAAU,EAAE,SAAS,EAAE,GAAG,oBAAc,CAAC,GAAG,CAAC,CAAC;QAEtD,MAAM,EAAE,KAAK,EAAE,WAAW,GAAG,EAAE,EAAE,GAAG,MAAM,CAAC,GAAG,IAAI,EAAE,CAAC;QAErD,MAAM,OAAO,GAAG,UAAU,CACxB,EAAE,UAAU,EAAE,MAAM,EAAE,WAAW,EAAE,KAAK,EAAE,EAC1C,WAEC,CACF,CAAC;QAEF,MAAM,QAAQ,GAAa,EAAE,CAAC;QAE9B,0EAA0E;QAC1E,IAAI,SAAS,CAAC,OAAO,EAAE;YACrB,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC;SAClC;QAED,8EAA8E;QAC9E,0EAA0E;QAC1E,MAAM,sBAAsB,GAAG,yBAAgB,CAC7C,qDAAqD,EACrD,GAAG,CAAC,WAAW,EACf,MAAM,CACP,CAAC;QACF,IAAI,sBAAsB,EAAE;YAC1B,QAAQ,CAAC,OAAO,CAAC,sBAAsB,CAAC,CAAC;SAC1C;QAED,IAAI,KAAK,EAAE;YACT,kJAAkJ;YAClJ,2EAA2E;YAC3E,0EAA0E;YAC1E,0EAA0E;YAC1E,yEAAyE;YACzE,wEAAwE;YACxE,4EAA4E;YAC5E,yEAAyE;YACzE,sEAAsE;YACtE,uDAAuD;YACvD,6CAA6C;YAC7C,QAAQ,CAAC,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,qCAAqC,CAAC,CAAC,CAAC;SAC1E;QAED,IAAI,sBAAsB,GAAY,CAAC,KAAK,CAAC;QAC7C,IAAI,CAAC,KAAK,IAAI,OAAO,GAAG,CAAC,GAAG,KAAK,WAAW,EAAE;YAC5C,sBAAsB,GAAG,GAAG,CAAC,GAAG,CAAC;SAClC;QAED,MAAM,WAAW,GAAG;YAClB;gBACE,IAAI,EAAE,SAAS,CAAC,QAAQ,CAAC,MAAM;gBAC/B,EAAE,EAAE,SAAS,CAAC,UAAU,CAAC,MAAM;gBAC/B,2DAA2D;gBAC3D,MAAM,EAAE;oBACN,wBAAwB;oBACxB,YAAY;oBACZ,YAAY;oBACZ,UAAU;oBACV,4GAA4G;oBAC5G,4BAA4B;iBAC7B;aACF;YACD;gBACE,IAAI,EAAE,SAAS,CAAC,QAAQ,CAAC,SAAS;gBAClC,EAAE,EAAE,SAAS,CAAC,UAAU,CAAC,SAAS;aACnC;SACF,CAAC;QAEF,IAAI,GAAG,CAAC,OAAO,KAAK,KAAK,EAAE;YACzB,WAAW,CAAC,IAAI,CAAC;gBACf,IAAI,EAAE,SAAS,CAAC,QAAQ,CAAC,aAAa;gBACtC,EAAE,EAAE,SAAS,CAAC,UAAU,CAAC,aAAa;aACvC,CAAC,CAAC;SACJ;QAED,MAAM,aAAa,GAAG,wBAAK,CAAC,uBAAY,CAAC,SAAS,CAAC,QAAQ,CAAC,SAAS,EAAE,EAAE,QAAQ,EAAE,MAAM,EAAE,CAAC,CAAC,CAAC;QAE9F,aAAa;QACb,MAAM,aAAa,GAAG,aAAa,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC;QAC7D,MAAM,KAAK,GAAmB,aAAa,CAAC,GAAG,CAAC,CAAC,KAAU,EAAE,EAAE,CAAC,CAAC;YAC/D,GAAG,EAAE,KAAK,CAAC,YAAY,CAAC,KAAK,CAAC;YAC9B,KAAK,EAAE,KAAK,CAAC,YAAY,CAAC,OAAO,CAAC;YAClC,IAAI,EAAE,KAAK,CAAC,YAAY,CAAC,MAAM,CAAC;YAChC,KAAK,EAAE,KAAK,CAAC,YAAY,CAAC,OAAO,CAAC;YAClC,IAAI,EAAE,KAAK;SACZ,CAAC,CAAC,CAAC;QAEJ,MAAM,CAAC,YAAY,CAAC,GAAG,KAAK,CAAC,MAAM,CACjC,IAAI,CAAC,EAAE,CAAC,OAAO,IAAI,CAAC,GAAG,KAAK,QAAQ,IAAI,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,QAAQ,CAAC,UAAU,CAAC,CACjF,CAAC;QACF,IAAI,gBAAgB,GAAG,SAAS,CAAC,QAAQ,CAAC,QAAQ,CAAC;QACnD,IAAI,YAAY,IAAI,YAAY,CAAC,IAAI,EAAE;YACrC,gBAAgB,GAAG,SAAS,CAAC,QAAQ,CAAC,GAAG,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;SAC9D;QAED,MAAM,oBAAoB,GAAG,CAAC,KAAyB,EAAsB,EAAE;YAC7E,IAAI,CAAC,KAAK;gBAAE,OAAO,KAAK,CAAC;YACzB,uCACK,KAAK,KACR,GAAG,EAAE,SAAS,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,IAClC;QACJ,CAAC,CAAC;QAEF,IAAI,aAAa,GAAqB;YACpC,IAAI;YACJ,KAAK,EAAE;gBACL,GAAG,EAAE,QAAQ;aACd;YACD,2DAA2D;YAC3D,wDAAwD;YACxD,IAAI,EAAE,MAAM;YACZ,OAAO;YACP,OAAO,EAAE,SAAS;YAClB,qCAAqC;YACrC,MAAM,EAAE,SAAS,CAAC,SAAS,EAAE,IAAI,EAAE,UAAU,CAAC;YAC9C,OAAO,EAAE;gBACP,0BAA0B;gBAC1B,MAAM;oBACJ,IAAI,yCAAkB,CAAC;wBACrB,4BAA4B,EAAE,CAAC,SAAS,CAAC,UAAU,CAAC,MAAM,CAAC;wBAC3D,GAAG,EAAE,KAAK;wBACV,OAAO,EAAE,KAAK;qBACf,CAAC;gBACJ,+BAA+B;gBAC/B,MAAM,IAAI,IAAI,6BAAiB,CAAC,WAAW,CAAC;gBAE5C,4BAA4B;gBAC5B,IAAI,+BAAqB,CAAC,GAAG,EAAE,aAAa,CAAC;gBAE7C,mCAAyB,CAAC,OAAO,CAAC,GAAG,EAAE,+BAAqB,CAAC;gBAE7D,GAAG,CAAC,GAAG;oBACL,IAAI,sCAA4B,CAC9B;wBACE,QAAQ,EAAE,gBAAgB;wBAC1B,IAAI,EAAE,eAAe;wBACrB,UAAU;qBACX,EACD,MAAM,CACP;gBACH,IAAI,8BAAoB,CACtB;oBACE,WAAW,EAAE,GAAG,CAAC,WAAW;oBAC5B,UAAU;oBACV,KAAK;iBACN,EACD,oBAAoB,CAAC,+BAAoB,CAAC,MAAM,CAAC,CAAC,CACnD;gBACD,sBAAsB;oBACpB,IAAI,+BAAqB,CACvB;wBACE,WAAW,EAAE,GAAG,CAAC,WAAW;wBAC5B,UAAU;wBACV,KAAK;qBACN,EACD;wBACE,IAAI,EAAE,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,SAAS;wBAC9B,YAAY,EAAE,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,eAAe;wBACvD,eAAe,EAAE,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,mBAAmB;wBAC9D,QAAQ,EAAE,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ;qBAC7C,EACD,oBAAoB,CAAC,8BAAmB,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,EACrD,oBAAoB,CAAC,sCAA2B,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAC9D;gBACH,sBAAsB;oBACpB,IAAI,kCAAwB,CAC1B;wBACE,WAAW,EAAE,GAAG,CAAC,WAAW;wBAC5B,UAAU;qBACX,EACD,oBAAoB,CAAC,8BAAmB,CAAC,MAAM,CAAC,CAAC,CAClD;gBAEH,wEAAwE;gBACxE,2BAA2B;gBAC3B,IAAI,8BAAoB,CAAC,SAAS,CAAC,IAAI,CAAC;gBAExC,IAAI,0BAAgB,CAAC;oBACnB,IAAI;oBACJ,SAAS;oBACT,MAAM;iBACP,CAAC;gBAEF,8DAA8D;gBAC9D,KAAK,IAAI,IAAI,oCAA0B,EAAE;gBAEzC,4EAA4E;gBAC5E,4EAA4E;gBAC5E,8DAA8D;gBAC9D,8DAA8D;gBAC9D,KAAK,IAAI,IAAI,uCAA6B,CAAC,SAAS,CAAC,OAAO,CAAC;gBAE7D,MAAM;oBACJ,IAAI,iCAAoB,CAAC;wBACvB,+DAA+D;wBAC/D,4BAA4B;wBAC5B,QAAQ,EAAE,uCAAuC;wBACjD,aAAa,EAAE,6CAA6C;qBAC7D,CAAC;gBACJ,8DAA8D;gBAC9D,uEAAuE;gBACvE,qEAAqE;gBACrE,iBAAiB;gBACjB,0EAA0E;gBAC1E,qDAAqD;gBACrD,IAAI,iCAAc,CAAC;oBACjB,QAAQ,EAAE,qBAAqB;oBAC/B,UAAU;oBACV,MAAM,EAAE,CAAC,EAAE,IAAI,EAAE,EAAE,EAAE;wBACnB,IACE,IAAI,CAAC,KAAK,CAAC,4EAA4E,CAAC,EACxF;4BACA,OAAO,KAAK,CAAC;yBACd;wBACD,iDAAiD;wBACjD,OAAO,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC,CAAC;oBAC/D,CAAC;oBACD,QAAQ,EAAE,CAAC,IAAyB,EAAE,KAAK,EAAE,WAAW,EAAE,EAAE;wBAC1D,MAAM,aAAa,GAAG,KAAK,CAAC,MAAM,CAAyB,CAAC,QAAQ,EAAE,IAAI,EAAE,EAAE;4BAC5E,IAAI,IAAI,CAAC,IAAI,EAAE;gCACb,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC;6BACjC;4BACD,OAAO,QAAQ,CAAC;wBAClB,CAAC,EAAE,IAAI,CAAC,CAAC;wBACT,MAAM,eAAe,GAAG,WAAW,CAAC,GAAG,CAAC,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC;wBAEvF,OAAO;4BACL,KAAK,EAAE,aAAa;4BACpB,WAAW,EAAE,eAAe;yBAC7B,CAAC;oBACJ,CAAC;iBACF,CAAC;gBAEF,wBAAwB,IAAI,IAAI,mCAA8B,EAAE;gBAEhE,IAAI,+BAAqB,EAAE;aAC5B,CAAC,MAAM,CAAC,OAAO,CAAC;YACjB,MAAM,EAAE;gBACN,oBAAoB,EAAE,KAAK;gBAC3B,KAAK,EAAE;oBACL,yDAAyD;oBACzD,EAAE,MAAM,EAAE,EAAE,aAAa,EAAE,KAAK,EAAE,EAAE;oBACpC;wBACE,KAAK,EAAE,0BAAgB,CAAC,GAAG,CAAC;qBAC7B;iBACF,CAAC,MAAM,CAAC,OAAO,CAAC;aAClB;YACD,aAAa,EAAE;gBACb,OAAO,EAAE;oBACP,kFAAkF;oBAClF,4BAA4B;oBAC5B,4BAAgB,CAAC,YAAY,CAAC,MAAM,CAAC;iBACtC;aACF;YACD,OAAO,EAAE;gBACP,UAAU,EAAE,CAAC,SAAS,EAAE,QAAQ,EAAE,MAAM,CAAC;gBACzC,UAAU,EAAE,6BAAuB,CAAC,KAAK,CAAC;gBAC1C,OAAO,EAAE;oBACP,sFAAsF;oBACtF,kDAAkD;oBAClD,4BAAgB;iBACjB;gBACD,QAAQ,EAAE,KAAK;aAChB;YACD,qDAAqD;YACrD,+CAA+C;YAE/C,wCAAwC;YACxC,WAAW,EAAE,gBAAO,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,YAAY,EAAE,MAAM,EAAE,iBAAiB,EAAE,MAAM,EAAE;SAChG,CAAC;QAEF,IAAI,MAAM,EAAE;YACV,aAAa,GAAG,0BAAiB,CAAC,aAAa,CAAC,CAAC;SAClD;aAAM;YACL,aAAa,GAAG,sBAAa,CAAC,aAAa,EAAE,GAAG,EAAE;gBAChD,WAAW,EAAE,IAAI,CAAC,WAAW;gBAC7B,KAAK,EAAE,IAAI,CAAC,KAAK;aAClB,CAAC,CAAC;SACJ;QAED,OAAO,sBAAa,CAAC,kBAAS,CAAC,aAAa,EAAE,gBAAU,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;IAC9E,CAAC;CAAA;AArTD,4BAqTC","sourcesContent":["/** @internal */ /** */\n/* eslint-env node */\nimport PnpWebpackPlugin from 'pnp-webpack-plugin';\nimport ModuleNotFoundPlugin from 'react-dev-utils/ModuleNotFoundPlugin';\nimport WatchMissingNodeModulesPlugin from 'react-dev-utils/WatchMissingNodeModulesPlugin';\nimport webpack, { Configuration, HotModuleReplacementPlugin, Options, Output } from 'webpack';\nimport WebpackDeepScopeAnalysisPlugin from 'webpack-deep-scope-plugin';\nimport ManifestPlugin from 'webpack-manifest-plugin';\nimport { projectHasModule } from '@expo/config';\nimport chalk from 'chalk';\nimport { CleanWebpackPlugin } from 'clean-webpack-plugin';\nimport CopyWebpackPlugin from 'copy-webpack-plugin';\nimport {\n  IconOptions,\n  getChromeIconConfig,\n  getFaviconIconConfig,\n  getSafariIconConfig,\n  getSafariStartupImageConfig,\n} from 'expo-pwa';\nimport { readFileSync } from 'fs-extra';\nimport { boolish } from 'getenv';\nimport MiniCssExtractPlugin from 'mini-css-extract-plugin';\nimport { parse } from 'node-html-parser';\nimport path from 'path';\n\nimport { withAlias, withDevServer, withNodeMocks, withOptimizations } from './addons';\nimport {\n  getAliases,\n  getConfig,\n  getMode,\n  getModuleFileExtensions,\n  getPathsAsync,\n  getPublicPaths,\n} from './env';\nimport { createAllLoaders } from './loaders';\nimport {\n  ApplePwaWebpackPlugin,\n  ChromeIconsWebpackPlugin,\n  ExpoDefinePlugin,\n  ExpoHtmlWebpackPlugin,\n  ExpoInterpolateHtmlPlugin,\n  ExpoProgressBarPlugin,\n  ExpoPwaManifestWebpackPlugin,\n  FaviconWebpackPlugin,\n} from './plugins';\nimport { HTMLLinkNode } from './plugins/ModifyHtmlWebpackPlugin';\nimport { Arguments, DevConfiguration, Environment, FilePaths, Mode } from './types';\nimport { overrideWithPropertyOrConfig } from './utils';\n\n// Source maps are resource heavy and can cause out of memory issue for large source files.\nconst shouldUseSourceMap = boolish('GENERATE_SOURCEMAP', true);\n\nfunction getDevtool(\n  { production, development }: { production: boolean; development: boolean },\n  { devtool }: { devtool?: Options.Devtool }\n): Options.Devtool {\n  if (production) {\n    // string or false\n    if (devtool !== undefined) {\n      // When big assets are involved sources maps can become expensive and cause your process to run out of memory.\n      return devtool;\n    }\n    return shouldUseSourceMap ? 'source-map' : false;\n  }\n  if (development) {\n    return 'cheap-module-source-map';\n  }\n  return false;\n}\n\nfunction getOutput(locations: FilePaths, mode: Mode, publicPath: string): Output {\n  const commonOutput: Output = {\n    // We inferred the \"public path\" (such as / or /my-project) from homepage.\n    // We use \"/\" in development.\n    publicPath,\n    // Build folder (default `web-build`)\n    path: locations.production.folder,\n    // this defaults to 'window', but by setting it to 'this' then\n    // module chunks which are built will work in web workers as well.\n    globalObject: 'this',\n  };\n\n  if (mode === 'production') {\n    commonOutput.filename = 'static/js/[name].[contenthash:8].js';\n    // There are also additional JS chunk files if you use code splitting.\n    commonOutput.chunkFilename = 'static/js/[name].[contenthash:8].chunk.js';\n    // Point sourcemap entries to original disk location (format as URL on Windows)\n    commonOutput.devtoolModuleFilenameTemplate = (\n      info: webpack.DevtoolModuleFilenameTemplateInfo\n    ): string => path.relative(locations.root, info.absoluteResourcePath).replace(/\\\\/g, '/');\n  } else {\n    // Add comments that describe the file import/exports.\n    // This will make it easier to debug.\n    commonOutput.pathinfo = true;\n    // Give the output bundle a constant name to prevent caching.\n    // Also there are no actual files generated in dev.\n    commonOutput.filename = 'static/js/bundle.js';\n    // There are also additional JS chunk files if you use code splitting.\n    commonOutput.chunkFilename = 'static/js/[name].chunk.js';\n    // Point sourcemap entries to original disk location (format as URL on Windows)\n    commonOutput.devtoolModuleFilenameTemplate = (\n      info: webpack.DevtoolModuleFilenameTemplateInfo\n    ): string => path.resolve(info.absoluteResourcePath).replace(/\\\\/g, '/');\n  }\n\n  return commonOutput;\n}\n\nexport default async function(\n  env: Environment,\n  argv: Arguments = {}\n): Promise<Configuration | DevConfiguration> {\n  if ('report' in env) {\n    console.warn(\n      chalk.bgRed.black(\n        `The \\`report\\` property of \\`@expo/webpack-config\\` is now deprecated.\\nhttps://expo.fyi/webpack-report-property-is-deprecated`\n      )\n    );\n  }\n  const config = getConfig(env);\n  const mode = getMode(env);\n  const isDev = mode === 'development';\n  const isProd = mode === 'production';\n\n  // Enables deep scope analysis in production mode.\n  // Remove unused import/exports\n  // override: `env.removeUnusedImportExports`\n  const deepScopeAnalysisEnabled = overrideWithPropertyOrConfig(\n    env.removeUnusedImportExports,\n    false\n    // isProd\n  );\n\n  const locations = env.locations || (await getPathsAsync(env.projectRoot));\n\n  const { publicPath, publicUrl } = getPublicPaths(env);\n\n  const { build: buildConfig = {} } = config.web || {};\n\n  const devtool = getDevtool(\n    { production: isProd, development: isDev },\n    buildConfig as {\n      devtool: Options.Devtool;\n    }\n  );\n\n  const appEntry: string[] = [];\n\n  // In solutions like Gatsby the main entry point doesn't need to be known.\n  if (locations.appMain) {\n    appEntry.push(locations.appMain);\n  }\n\n  // Add a loose requirement on the ResizeObserver polyfill if it's installed...\n  // Avoid `withEntry` as we don't need so much complexity with this config.\n  const resizeObserverPolyfill = projectHasModule(\n    'resize-observer-polyfill/dist/ResizeObserver.global',\n    env.projectRoot,\n    config\n  );\n  if (resizeObserverPolyfill) {\n    appEntry.unshift(resizeObserverPolyfill);\n  }\n\n  if (isDev) {\n    // https://github.com/facebook/create-react-app/blob/e59e0920f3bef0c2ac47bbf6b4ff3092c8ff08fb/packages/react-scripts/config/webpack.config.js#L144\n    // Include an alternative client for WebpackDevServer. A client's job is to\n    // connect to WebpackDevServer by a socket and get notified about changes.\n    // When you save a file, the client will either apply hot updates (in case\n    // of CSS changes), or refresh the page (in case of JS changes). When you\n    // make a syntax error, this client will display a syntax error overlay.\n    // Note: instead of the default WebpackDevServer client, we use a custom one\n    // to bring better experience for Create React App users. You can replace\n    // the line below with these two lines if you prefer the stock client:\n    // require.resolve('webpack-dev-server/client') + '?/',\n    // require.resolve('webpack/hot/dev-server'),\n    appEntry.unshift(require.resolve('react-dev-utils/webpackHotDevClient'));\n  }\n\n  let generatePWAImageAssets: boolean = !isDev;\n  if (!isDev && typeof env.pwa !== 'undefined') {\n    generatePWAImageAssets = env.pwa;\n  }\n\n  const filesToCopy = [\n    {\n      from: locations.template.folder,\n      to: locations.production.folder,\n      // We generate new versions of these based on the templates\n      ignore: [\n        'expo-service-worker.js',\n        'serve.json',\n        'index.html',\n        'icon.png',\n        // We copy this over in `withWorkbox` as it must be part of the Webpack `entry` and have templates replaced.\n        'register-service-worker.js',\n      ],\n    },\n    {\n      from: locations.template.serveJson,\n      to: locations.production.serveJson,\n    },\n  ];\n\n  if (env.offline !== false) {\n    filesToCopy.push({\n      from: locations.template.serviceWorker,\n      to: locations.production.serviceWorker,\n    });\n  }\n\n  const templateIndex = parse(readFileSync(locations.template.indexHtml, { encoding: 'utf8' }));\n\n  // @ts-ignore\n  const templateLinks = templateIndex.querySelectorAll('link');\n  const links: HTMLLinkNode[] = templateLinks.map((value: any) => ({\n    rel: value.getAttribute('rel'),\n    media: value.getAttribute('media'),\n    href: value.getAttribute('href'),\n    sizes: value.getAttribute('sizes'),\n    node: value,\n  }));\n\n  const [manifestLink] = links.filter(\n    link => typeof link.rel === 'string' && link.rel.split(' ').includes('manifest')\n  );\n  let templateManifest = locations.template.manifest;\n  if (manifestLink && manifestLink.href) {\n    templateManifest = locations.template.get(manifestLink.href);\n  }\n\n  const ensureSourceAbsolute = (input: IconOptions | null): IconOptions | null => {\n    if (!input) return input;\n    return {\n      ...input,\n      src: locations.absolute(input.src),\n    };\n  };\n\n  let webpackConfig: DevConfiguration = {\n    mode,\n    entry: {\n      app: appEntry,\n    },\n    // https://webpack.js.org/configuration/other-options/#bail\n    // Fail out on the first error instead of tolerating it.\n    bail: isProd,\n    devtool,\n    context: __dirname,\n    // configures where the build ends up\n    output: getOutput(locations, mode, publicPath),\n    plugins: [\n      // Delete the build folder\n      isProd &&\n        new CleanWebpackPlugin({\n          cleanOnceBeforeBuildPatterns: [locations.production.folder],\n          dry: false,\n          verbose: false,\n        }),\n      // Copy the template files over\n      isProd && new CopyWebpackPlugin(filesToCopy),\n\n      // Generate the `index.html`\n      new ExpoHtmlWebpackPlugin(env, templateIndex),\n\n      ExpoInterpolateHtmlPlugin.fromEnv(env, ExpoHtmlWebpackPlugin),\n\n      env.pwa &&\n        new ExpoPwaManifestWebpackPlugin(\n          {\n            template: templateManifest,\n            path: 'manifest.json',\n            publicPath,\n          },\n          config\n        ),\n      new FaviconWebpackPlugin(\n        {\n          projectRoot: env.projectRoot,\n          publicPath,\n          links,\n        },\n        ensureSourceAbsolute(getFaviconIconConfig(config))\n      ),\n      generatePWAImageAssets &&\n        new ApplePwaWebpackPlugin(\n          {\n            projectRoot: env.projectRoot,\n            publicPath,\n            links,\n          },\n          {\n            name: env.config.web.shortName,\n            isFullScreen: env.config.web.meta.apple.touchFullscreen,\n            isWebAppCapable: env.config.web.meta.apple.mobileWebAppCapable,\n            barStyle: env.config.web.meta.apple.barStyle,\n          },\n          ensureSourceAbsolute(getSafariIconConfig(env.config)),\n          ensureSourceAbsolute(getSafariStartupImageConfig(env.config))\n        ),\n      generatePWAImageAssets &&\n        new ChromeIconsWebpackPlugin(\n          {\n            projectRoot: env.projectRoot,\n            publicPath,\n          },\n          ensureSourceAbsolute(getChromeIconConfig(config))\n        ),\n\n      // This gives some necessary context to module not found errors, such as\n      // the requesting resource.\n      new ModuleNotFoundPlugin(locations.root),\n\n      new ExpoDefinePlugin({\n        mode,\n        publicUrl,\n        config,\n      }),\n\n      // This is necessary to emit hot updates (currently CSS only):\n      isDev && new HotModuleReplacementPlugin(),\n\n      // If you require a missing module and then `npm install` it, you still have\n      // to restart the development server for Webpack to discover it. This plugin\n      // makes the discovery automatic so you don't have to restart.\n      // See https://github.com/facebook/create-react-app/issues/186\n      isDev && new WatchMissingNodeModulesPlugin(locations.modules),\n\n      isProd &&\n        new MiniCssExtractPlugin({\n          // Options similar to the same options in webpackOptions.output\n          // both options are optional\n          filename: 'static/css/[name].[contenthash:8].css',\n          chunkFilename: 'static/css/[name].[contenthash:8].chunk.css',\n        }),\n      // Generate an asset manifest file with the following content:\n      // - \"files\" key: Mapping of all asset filenames to their corresponding\n      //   output file so that tools can pick it up without having to parse\n      //   `index.html`\n      // - \"entrypoints\" key: Array of files which are included in `index.html`,\n      //   can be used to reconstruct the HTML if necessary\n      new ManifestPlugin({\n        fileName: 'asset-manifest.json',\n        publicPath,\n        filter: ({ path }) => {\n          if (\n            path.match(/(apple-touch-startup-image|apple-touch-icon|chrome-icon|precache-manifest)/)\n          ) {\n            return false;\n          }\n          // Remove compressed versions and service workers\n          return !(path.endsWith('.gz') || path.endsWith('worker.js'));\n        },\n        generate: (seed: Record<string, any>, files, entrypoints) => {\n          const manifestFiles = files.reduce<Record<string, string>>((manifest, file) => {\n            if (file.name) {\n              manifest[file.name] = file.path;\n            }\n            return manifest;\n          }, seed);\n          const entrypointFiles = entrypoints.app.filter(fileName => !fileName.endsWith('.map'));\n\n          return {\n            files: manifestFiles,\n            entrypoints: entrypointFiles,\n          };\n        },\n      }),\n\n      deepScopeAnalysisEnabled && new WebpackDeepScopeAnalysisPlugin(),\n\n      new ExpoProgressBarPlugin(),\n    ].filter(Boolean),\n    module: {\n      strictExportPresence: false,\n      rules: [\n        // Disable require.ensure because it breaks tree shaking.\n        { parser: { requireEnsure: false } },\n        {\n          oneOf: createAllLoaders(env),\n        },\n      ].filter(Boolean),\n    },\n    resolveLoader: {\n      plugins: [\n        // Also related to Plug'n'Play, but this time it tells Webpack to load its loaders\n        // from the current package.\n        PnpWebpackPlugin.moduleLoader(module),\n      ],\n    },\n    resolve: {\n      mainFields: ['browser', 'module', 'main'],\n      extensions: getModuleFileExtensions('web'),\n      plugins: [\n        // Adds support for installing with Plug'n'Play, leading to faster installs and adding\n        // guards against forgotten dependencies and such.\n        PnpWebpackPlugin,\n      ],\n      symlinks: false,\n    },\n    // Turn off performance processing because we utilize\n    // our own (CRA) hints via the FileSizeReporter\n\n    // TODO: Bacon: Remove this higher value\n    performance: boolish('CI', false) ? false : { maxAssetSize: 600000, maxEntrypointSize: 600000 },\n  };\n\n  if (isProd) {\n    webpackConfig = withOptimizations(webpackConfig);\n  } else {\n    webpackConfig = withDevServer(webpackConfig, env, {\n      allowedHost: argv.allowedHost,\n      proxy: argv.proxy,\n    });\n  }\n\n  return withNodeMocks(withAlias(webpackConfig, getAliases(env.projectRoot)));\n}\n"]}